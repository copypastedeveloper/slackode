services:
  bot:
    build: .
    env_file: .env
    volumes:
      - repo-cache:/app/repo
      - opencode-data:/home/appuser/.local/share/opencode
      - bot-data:/app/data
    environment:
      - SESSIONS_DB_PATH=/app/data/sessions.db
      # Map Slack channels to OpenCode agent profiles (defined in opencode.json).
      # Example: CHANNEL_AGENTS={"incidents":"incidents","planning":"planning"}
      # - CHANNEL_AGENTS
    read_only: true
    tmpfs:
      - /tmp:size=100M
    restart: unless-stopped

volumes:
  repo-cache:
  opencode-data:
  bot-data:
