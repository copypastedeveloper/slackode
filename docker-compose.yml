services:
  bot:
    build: .
    env_file: .env
    volumes:
      - repo-cache:/app/repo
      - opencode-data:/home/appuser/.local/share/opencode
    environment:
      - SESSIONS_DB_PATH=/home/appuser/.local/share/opencode/sessions.db
      - REPO_DIR=/app/repo
      - TOOLS_SEED_PATH=/app/tools.json
    read_only: true
    tmpfs:
      - /tmp:size=100M,exec,uid=1001,gid=1001
      - /home/appuser/.local/state:size=10M,uid=1001,gid=1001
      - /home/appuser/.config:size=10M,uid=1001,gid=1001
      - /home/appuser/.cache:size=50M,uid=1001,gid=1001
      - /home/appuser/.npm:size=512M,exec,uid=1001,gid=1001
    restart: unless-stopped

volumes:
  repo-cache:
  opencode-data:
